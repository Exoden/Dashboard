{% extends "IdleBundle:Default:armory.html.twig" %}

{% block page_armory %}
    <div class="col-md-5 out-menu">
        <div class="col-md-12 menu">
            <h3>Heroes</h3>
            {% for key, hero in heroes %}
                <div id="hero_{{ key }}" class="row details-hero">
                    <p>{{ hero.name }} ({{ hero.age }})</p>
                    <div class="item equipment weapon"
                         title="{% if equipments[key]['weapon'] is not null %}{{ equipments[key]['weapon'].name }}{% endif %}"
                         data-value="{% if equipments[key]['weapon'] is not null %}{{ equipments[key]['weapon'].id }}{% endif %}"
                         data-toggle="popover" data-placement="top" data-trigger="hover"
                         data-content="{% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'weapon', 'hero': hero, 'obj': equipments[key]['weapon']} %}">
                        <img src="" alt="weapon">
                    </div>
                    <div class="item equipment offhand"
                         title="{% if equipments[key]['offhand'] is not null %}{{ equipments[key]['offhand'].name }}{% endif %}"
                         data-value="{% if equipments[key]['offhand'] is not null %}{{ equipments[key]['offhand'].id }}{% endif %}"
                         data-toggle="popover" data-placement="top" data-trigger="hover"
                         data-content="{% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'armor', 'hero': hero, 'obj': equipments[key]['offhand']} %}">
                        <img src="" alt="offhand">
                    </div>
                    <div class="item equipment artifact"
                         title="{% if equipments[key]['artifact'] is not null %}{{ equipments[key]['artifact'].name }}{% endif %}"
                         data-value="{% if equipments[key]['artifact'] is not null %}{{ equipments[key]['artifact'].id }}{% endif %}"
                         data-toggle="popover" data-placement="top" data-trigger="hover"
                         data-content="{% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'armor', 'hero': hero, 'obj': equipments[key]['artifact']} %}">
                        <img src="" alt="artifact">
                    </div>
                    <div class="item equipment armor"
                         title="{% if equipments[key]['armor'] is not null %}{{ equipments[key]['armor'].name }}{% endif %}"
                         data-value="{% if equipments[key]['armor'] is not null %}{{ equipments[key]['armor'].id }}{% endif %}"
                         data-toggle="popover" data-placement="top" data-trigger="hover"
                         data-content="{% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'armor', 'hero': hero, 'obj': equipments[key]['armor']} %}">
                        <img src="" alt="armor">
                    </div>
                    <div class="item equipment helmet"
                         title="{% if equipments[key]['helmet'] is not null %}{{ equipments[key]['helmet'].name }}{% endif %}"
                         data-value="{% if equipments[key]['helmet'] is not null %}{{ equipments[key]['helmet'].id }}{% endif %}"
                         data-toggle="popover" data-placement="top" data-trigger="hover"
                         data-content="{% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'armor', 'hero': hero, 'obj': equipments[key]['helmet']} %}">
                        <img src="" alt="helmet">
                    </div>
                    <div class="item equipment gloves"
                         title="{% if equipments[key]['gloves'] is not null %}{{ equipments[key]['gloves'].name }}{% endif %}"
                         data-value="{% if equipments[key]['gloves'] is not null %}{{ equipments[key]['gloves'].id }}{% endif %}"
                         data-toggle="popover" data-placement="top" data-trigger="hover"
                         data-content="{% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'armor', 'hero': hero, 'obj': equipments[key]['gloves']} %}">
                        <img src="" alt="gloves">
                    </div>
                    <div class="item equipment jewel"
                         title="{% if equipments[key]['jewel'] is not null %}{{ equipments[key]['jewel'].name }}{% endif %}"
                         data-value="{% if equipments[key]['jewel'] is not null %}{{ equipments[key]['jewel'].id }}{% endif %}"
                         data-toggle="popover" data-placement="top" data-trigger="hover"
                         data-content="{% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'armor', 'hero': hero, 'obj': equipments[key]['jewel']} %}">
                        <img src="" alt="jewel">
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="col-md-3 out-menu">
        <div class="col-md-12 menu">
            <h3>Stuff</h3>
            <table class="table table-striped table-condensed">
                <thead>
                <tr>
                    <th style="text-align: center">Charac</th>
                    <th style="text-align: center">Equiped</th>
                    <th style="text-align: center">Modif</th>
                    <th style="text-align: center">Selected</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Health</td>
                    <td>+4</td>
                    <td>+1</td>
                    <td>+5</td>
                </tr>
                <tr>
                    <td>Dodge</td>
                    <td>+12</td>
                    <td>-4</td>
                    <td>+8</td>
                </tr>
                </tbody>
            </table>
            <button class="btn btn-danger btn-drop" style="display: none; float: left; margin: 5px;">Drop</button>
            <button class="btn btn-success btn-equip" style="display: none; float: right; margin: 5px;">Equiped</button>
        </div>
    </div>
    <div class="col-md-4 out-menu">
        <div class="col-md-12 menu">
            <h3>Equipments</h3>
            <div class="stuffs">
                {% for stuff in stuffs %}
                    <div class="item stuff fixed" title="{{ stuff['obj'].item.name }}" data-value="{{ stuff['obj'].id }}" data-toggle="popover" data-placement="top" data-trigger="hover" data-content="
                        {% if stuff['obj'].item.typeItem.name == "Equipment" %}
                            {% if stuff['obj'].type.name == "Weapon" %}
                                {% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'weapon', 'hero': 0, 'obj': stuff['obj']} %}
                            {% else %}
                                {% include 'IdleBundle:Default:popover_equipment.html.twig' with {'type': 'armor', 'hero': 0, 'obj': stuff['obj']} %}
                            {% endif %}
                        {% endif %}
                        ">
                        <img src="{% if stuff['obj'].item.image is not null %}{{ asset('images/Idle/' ~ stuff['obj'].item.typeItem.name ~ 's/' ~ stuff['obj'].item.image) }}{% endif %}" alt="{{ stuff['obj'].item.name }}">
                        <p>{{ stuff['obj'].item.name }} x<span class="quantity">{{ stuff['quantity'] }}</span></p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
        $(document).ready(function() {
            $('[data-toggle="popover"]').popover({
                html: true
            });
        });

        $('.equipment').click(show_equipment_stats);

        $('.stuff').click(show_stuff_stats);

        $('.btn-drop').click(drop_equipment);

        $('.btn-equip').click(equip_stuff);

        function show_equipment_stats()
        {
            var elem = $(this);
            console.log(elem);
            if (elem.closest('div').data('value')) {
                var url = '{{ path("show_equipment_stats", {'equipment_id': 'EQUIPMENT_ID'}) }}';
                url = url.replace("EQUIPMENT_ID", elem.closest('div').data('value'));
                console.log(url);
                var jhrx = $.ajax(url)
                    .done(function (data) {
                        if (data.success) {
                            console.log('OK');

                            display_button_drop();
                        }
                    })
            }
        }

        function show_stuff_stats()
        {
            var elem = $(this);
            console.log(elem);
            var url = '{{ path("show_stuff_stats", {'stuff_id': 'STUFF_ID'}) }}';
            url = url.replace("STUFF_ID", elem.closest('div').data('value'));
            console.log(url);
            var jhrx = $.ajax(url)
                .done(function (data) {
                    if (data.success) {
                        console.log('OK');

                        {# TODO : display_button_drop IF hero has equipment #}
                        display_button_drop();
                        display_button_equip();
                    }
                })
        }

        function drop_equipment()
        {
            var elem = $(this);
            console.log(elem);
            var url = '{{ path("drop_equipment", {'equipment_id': 'EQUIPMENT_ID'}) }}';
            url = url.replace("EQUIPMENT_ID", elem.closest('div').data('value'));
            console.log(url);
            var jhrx = $.ajax(url)
                .done(function (data) {
                    if (data.success) {
                        console.log('OK');
                    }
                })
        }

        function equip_stuff()
        {
            var elem = $(this);
            console.log(elem);
            var url = '{{ path("equip_stuff", {'stuff_id': 'STUFF_ID'}) }}';
            url = url.replace("STUFF_ID", elem.closest('div').data('value'));
            console.log(url);
            var jhrx = $.ajax(url)
                .done(function (data) {
                    if (data.success) {
                        console.log('OK');
                    }
                })
        }

        function display_button_drop()
        {
            $('.btn-drop').css('display', 'block');
        }
        function display_button_equip()
        {
            $('.btn-equip').css('display', 'block');
        }
    </script>
{% endblock %}